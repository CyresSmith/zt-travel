generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id                    String                 @id @default(cuid())
  name                  String                 @default("")
  email                 String                 @unique
  emailVerified         DateTime?              @map("email_verified")
  phone                 String                 @default("")
  image                 String                 @default("")
  password              String?
  role                  UserRole               @default(USER)
  isTwoFactorEnable     Boolean                @default(false)
  createdAt             DateTime               @default(now()) @map("created_at")
  updatedAt             DateTime               @updatedAt @map("updated_at")
  articles              Article[]
  events                Event[]
  eventRewiews          EventReview[]
  places                Place[]
  placeRewiews          PlaceReview[]
  twoFactorConfirmation TwoFactorConfirmation?
  accounts              Account[]

  @@map("users")
}

model Account {
  userId            String
  type              String
  provider          String
  providerAccountId String
  refresh_token     String?
  access_token      String?
  expires_at        Int?
  token_type        String?
  scope             String?
  id_token          String?
  session_state     String?
  createdAt         DateTime @default(now()) @map("created_at")
  updatedAt         DateTime @updatedAt @map("updated_at")
  user              User     @relation(fields: [userId], references: [id], onDelete: Cascade)

  @@id([provider, providerAccountId])
  @@map("accounts")
}

model VerificationToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model PasswordResetToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model TwoFactorToken {
  id      String   @id @default(cuid())
  email   String
  token   String   @unique
  expires DateTime

  @@unique([email, token])
}

model TwoFactorConfirmation {
  id     String @id @default(cuid())
  userId String @unique @map("user_id")
  user   User   @relation(fields: [userId], references: [id], onDelete: Cascade)
}

model PlaceCategory {
  id        String    @id @default(cuid())
  createdAt DateTime  @default(now()) @map("created_at")
  updatedAt DateTime  @updatedAt @map("updated_at")
  type      PlaceType
  name_uk   String    @unique
  name_en   String    @unique
  slug      String
  palces    Place[]
}

model Place {
  id          String   @id @default(uuid())
  createdAt   DateTime @default(now()) @map("created_at")
  updatedAt   DateTime @updatedAt @map("updated_at")
  logo        String?
  image       String?
  images      String[] @default([])
  phone       String?
  email       String?
  url         String?
  facebook    String?
  instagram   String?
  gmapsUrl    String?  @map("gmaps_url")
  latLang     String[] @default([])
  slug        String   @unique
  rating      Int      @default(0)
  views       Int      @default(0)
  categoryId  String   @map("category_id")
  userId      String   @map("user_id")
  communityId String   @map("community_id")

  community Community     @relation(fields: [communityId], references: [id])
  articles  Article[]
  events    Event[]
  category  PlaceCategory @relation(fields: [categoryId], references: [id])
  user      User          @relation(fields: [userId], references: [id], onDelete: NoAction)
  rewiews   PlaceReview[]
  placeText PlaceText[]
}

model PlaceText {
  place   Place  @relation(fields: [placeId], references: [id])
  placeId String

  locale  Locale
  name    String @unique
  desc    String
  address String

  @@id([placeId, locale])
}

model PlaceReview {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  rating    Int
  text      String
  placetId  String   @map("place_id")
  userId    String   @map("user_id")
  place     Place    @relation(fields: [placetId], references: [id])
  user      User     @relation(fields: [userId], references: [id], onDelete: NoAction)
}

model EventCategory {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  name_uk   String   @unique
  name_en   String   @unique
  slug      String
  events    Event[]
}

model EventReview {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  rating    Int
  text      String
  eventId   String   @map("event_id")
  userId    String   @map("user_id")
  event     Event    @relation(fields: [eventId], references: [id])
  user      User     @relation(fields: [userId], references: [id], onDelete: NoAction)
}

model Event {
  id         String        @id @default(uuid())
  createdAt  DateTime      @default(now()) @map("created_at")
  updatedAt  DateTime      @updatedAt @map("updated_at")
  name_uk    String        @unique
  name_en    String        @unique
  desc_uk    String
  desc_en    String
  address_uk String
  address_en String
  image      String?
  images     String[]      @default([])
  phone      String
  url        String?
  slug       String        @unique
  rating     Int           @default(0)
  views      Int           @default(0)
  start      String[]
  duration   Int
  periodic   Boolean
  categoryId String        @map("category_id")
  placeId    String?       @map("place_id")
  userId     String        @map("user_id")
  category   EventCategory @relation(fields: [categoryId], references: [id])
  palce      Place?        @relation(fields: [placeId], references: [id])
  user       User          @relation(fields: [userId], references: [id], onDelete: NoAction)
  rewiews    EventReview[]
}

model Tag {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  type      TagType
  name_uk   String   @unique
  name_en   String   @unique
}

model Article {
  id        String   @id @default(uuid())
  createdAt DateTime @default(now()) @map("created_at")
  updatedAt DateTime @updatedAt @map("updated_at")
  name_uk   String   @unique
  name_en   String?  @unique
  desc_uk   String
  desc_en   String?
  text_uk   String
  text_en   String?
  image     String?
  images    String[] @default([])
  slug      String   @unique
  views     Int      @default(0)
  placeId   String?  @map("place_id")
  userId    String?  @map("user_id")
  place     Place?   @relation(fields: [placeId], references: [id])
  user      User?    @relation(fields: [userId], references: [id], onDelete: NoAction)
}

model District {
  id          String      @id @default(uuid())
  name_uk     String
  name_en     String?
  geometry    String
  createdAt   DateTime    @default(now()) @map("created_at")
  communities Community[]
}

model Community {
  id         String   @id @default(uuid())
  name_uk    String
  name_en    String?
  districtId String   @map("district_id")
  geometry   String
  createdAt  DateTime @default(now()) @map("created_at")
  district   District @relation(fields: [districtId], references: [id])
  Place      Place[]
}

enum UserRole {
  USER
  ADMIN
}

enum PlaceType {
  INTERESTING_PLACE
  RESIDENCE
  EAT
}

enum TagType {
  PLACE
  EVENT
  ARTICLE
}

enum Locale {
  uk
  en
}
